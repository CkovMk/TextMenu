[TOC]

## 版本说明

### v2.0.0

by CkovMk 2021.12.01

**改动说明**

- 作为独立组件发布的第一个版本。
- FIXME

**开发计划**

**已知问题**


### v1.0.0

by CkovMk <maqike@qq.com> 2021.04.02

**改动说明**

- 适配新的帧缓存、EXTINT、PITMGR改动。
- 新增菜单项迭代结构体和迭代器函数，并用迭代器重写自带的Flash读写函数。您可以使用菜单项迭代器快速遍历所有菜单项，方便您实现在自己的算法。

**开发计划**

- 暂无

**已知问题**

- 暂无



### v0.1.7

by CkovMk <maqike@qq.com> 2020.11.22

**改动说明**

- 新增全局状态标志位`menu_message_strBufOverride`（字符缓存超控标志位），支持菜单项直接打印帧缓存。
- 新增函数`menu_list_t *MENU_DirGetList(const char *str);`和`menu_itemIfce_t *MENU_DirGetItem(const menu_list_t *dir, const char *str);`，用于按路径查找菜单列表和菜单项。
- 适配SYSLOG。修改了MENU_PORT中的LOG打印接口。现在可以分别配置不同组件的LOG级别。
- 删除了不必要的`extern "C {...}"`。
- 新增路径查询API：`menu_list_t *MENU_DirGetList(const char *str);` 与`menu_itemIfce_t *MENU_DirGetItem(const menu_list_t *dir, const char *str);`，用于根据菜单结构（路径）查找菜单列表和菜单项。
- 事件处理接口移至`app_menu_port.cpp`中。

**开发计划**

- C++化
- 菜单项迭代器
- 独立屏幕接口、独立存储接口

**已知问题**

- 暂无



### v0.1.6

by CkovMk <maqike@qq.com> 2020.11.09

**改动说明**

- 适配DISP_SSD1306驱动更新，新增全缓存屏幕移植接口。现在屏幕可支持全缓存打印。
- 仿照C++虚表，修改了菜单项适配器和类型多态原理。现在只有菜单项构造需要使用`swich-case`结构，其他函数调用均由查表得到。
- 现在`menuItem_dataExt_HasMinMax`扩展属性已对NVM读取生效。
- 调整默认事件中断优先级为12。
- 补全移植文档。

**开发计划**

- 适配全缓存屏幕API，创建面向不同屏幕的移植接口。
- 创建文件存储接口。

**已知问题**

- 局部数据区间的数据拷贝功能仍不可用。



### v0.1.5

by CkovMk <maqike@qq.com> 2020.10.30

功能完善。

**改动说明**

- 新增了两个顶层API：`MENU_Suspend(void)`和`MENU_Resume(void);`，用于暂时地禁用/启用菜单。
- 菜单项属性Flag调整/新增：`menuItem_dataExt_HasMinMax`属性，调整`menuItem_data_ROFlag`、`menuItem_data_NoSave`、`menuItem_data_NoLoad`等的含义
- 修改了部分菜单项的显示格式
- 修复了一些Bug。现在，在使用“disp_noPreview”属性时，快速调参将被禁用。
- 所有代码由`*.x`更新为`*.xpp`。

**开发计划**

- 适配全缓存屏幕API，创建面向不同屏幕的移植接口。
- 创建文件存储接口。
- （下一个大版本）调整菜单类型的多态方式，使用函数指针+结构体的方式替代现有的宏定义方式。这可能需要花费非常多的时间。

**已知问题**

- 局部数据区间的数据拷贝功能仍不可用。
- `menuItem_dataExt_HasMinMax`扩展属性对数据初值、NVM读取无效。



### v0.1.4

by CkovMk <maqike@qq.com> 2020.10.09

继续完善功能

**改动说明**

- 修改了`procType`菜单的运行逻辑，现在`procType`类型的菜单具有可进入的二级菜单，仅在二级菜单内短按`OK`键才会执行函数；任何时候在二级菜单内长按`OK`键将直接退出二级菜单。新增了两个属性Flag：`menuItem_proc_runOnce`表示该函数仅运行一次就自动退出。所有没有此Flag的`procType菜单`短按OK键后都不会退出，只能由函数内逻辑退出或长按OK键退出。`menuItem_proc_uiDisplay`属性Flag表示该函数具有打印屏幕的功能，将禁用菜单默认的界面显示。
- 修改了菜单刷新逻辑。现在将有一个PITMGR任务以4Hz的频率写入屏幕刷新事件（`menu_message_printDisp`）并触发菜单响应。另外，按键操作也将写入屏幕刷新事件（`menu_message_buttonOp`）。
- 优化了一些不需要的全局变量，现在已被宏定义替代。

**开发计划**

- 创建面向不同屏幕的移植接口。

**已知问题**

- 菜单内在不同局部存储区拷贝数据的功能存在问题，可能会造成数据丢失。
- 在使用“disp_noPreview”属性时，仍可进行快速调参。



### v0.1.3

by CkovMk <maqike@qq.com> 2020.07.31

增加了一些属性Flag。

**改动说明**

- 增加了`CMODULE_USE_APP_MENU`宏，用于启用或禁用整个APP_MENU模块。
- 增加了`CMODULE_MENU_USE_BUTTON`宏，用于启用或禁用菜单依赖的DRV_BUTTON模块和自带的MENU_BUTTON按键事件模块。禁用该宏后，您需要手动向菜单发送按键消息。
- 增加了`CMODULE_MENU_USE_NVM`宏，用于启用或禁用自带的MENU_NVM非易失性存储模块。禁用该宏后，菜单将无法以任何形式保存参数。
- 在启用`CMODULE_MENU_USE_NVM`宏时，您现在可以自定义数据的存储方式。在`app_menu_port.h`内提供了对各存储区大小、位置的快速设置。您还可以自定义NVM后端驱动。例如，通过适配，您现在可以将数据存在外部EEPROM或SPI Flash上。目前，MENU_NVM仅支持块级存储，不支持文件存储。
- 由于CMODULE_Modules上层结构调整，删除掉了`hitsic_def.h`，APP_MENU不再依赖该头文件。

**开发计划**

- 增加对文件存储的支持
- 编写全面的移植指南，整理应用指南。
- 属性Flag提供更多选项，并在运行过程中指示该变量是否已修改。
- 优化头文件包含关系，只包含必要的库，且所有平台相关的头文件全部移动到移植文件中。

**已知问题**

- 菜单内在不同局部存储区拷贝数据的功能存在问题，可能会造成数据丢失。



### v0.1.2

by CkovMk <maqike@qq.com> 2019.11.22

主要功能初步完善。

**改动说明**

- 菜单存储功能已可以正常使用。菜单内含1个全局存储区和3个局部存储区，全局存储区用于存储公共参数，而三个局部存储区可存储三组不同参数。当前所使用的参数组可以在菜单内选择。单片机上电后可以自动读取保存的数据。**注意：存储区间的数据拷贝功能还不完善，可能造成数据丢失。**
- 调整及新增了一些属性Flag。现在，`menuItem_data_ROFlag` 标志仅表示该变量不能从菜单修改，但仍会被保存到对应的Nvm存储区。如要禁止保存该变量，使用新增的`menuItem_data_NoSave` 标志。**注意：此标志仅代表在保存菜单时不会保存该变量，用户仍可以对具有此标志的菜单项分配存储空间，并手动保存改变量到分配的地址。**

**开发计划**

- 完善菜单存储功能

- 完善函数类型菜单

- 属性Flag提供更多选项，并在运行过程中指示该变量是否已修改。

**已知问题**

- 存储区间的数据拷贝功能还不完善，可能造成数据丢失。





### v0.1.1

by CkovMk <maqike@qq.com> 2019.11.02

第一个正式版。经过早期测试没有严重Bug。一些功能仍未完善。

**主要功能**

- 使用单条语句构造和析构菜单和菜单项。菜单项的插入和删除与类型无关。

- 低优先级中断操作，不干扰高优先级中断，也不占用`main()`函数。

- 所有按键均支持短按、长按、长按重复三种操作。在任意菜单列表内长按OK返回上一级菜单。也可以使用每个菜单列表顶部的[back]菜单项返回上级菜单。

- 可以使用空类型（分割线）、整形（int32_t）、浮点型（float）、菜单跳转、函数调用五种菜单项。

  - 参数类型（整数和浮点）支持在菜单列表内快速调参，其中int32_t型在仅有一位数时调整第一位有效数字，在大于等于两位数时固定调整第二位有效数字；float型全范围内固定调节第二位有效数字。
  - 参数类型在菜单列表内具有自适应显示。（-10^5 ，+10^5）内的整型参数和（-10^4，-10^-1）∪（+10^-1，+10^4）内的浮点参数将直接显示，这些范围外的参数将采用四位有效数字的“准”科学计数法显示。该显示方式为`±abcd±e`的形式，为了节约显示空间没有使用标准的小数点表示法并省掉了有效数字与数量级之间的字符E，表示`±abcd × 10^±e`。
  - 参数类型具有二级调参页面，可以科学计数法的方式对前四位有效数字进行精确设置。在二级调参页面中，短按OK键可以保存并退出，长按OK键可以放弃更改并退出。
  - 所有菜单项都有独立的属性控制，可以设置只读、可写、保存区域、显示方式等属性，部分属性在此版本中不可用，在后续的更新中将陆续实现。
- 可以支持任意数量的子菜单和菜单项，一个子菜单可以有一个或多个入口。

**已知问题**

- 目前菜单仅能保证基本使用，有些功能仅做了接口，并没有实现。使用上可能会引起困惑。
- 该菜单没用添加定时任务，故仅在有按键操作时刷新菜单。相关接口已经留好，后续更新中实现。
- 菜单的Flash保存功能还在开发中，暂时无法使用。菜单内的数据在复位后会丢失，需要手动记录。
- 删去了紫丁香LOGO的相关数据，无法显示紫丁香LOGO。